<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</title>
    <script src="https://cdn.socket.io/4.8.3/socket.io.min.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        .loading { background: #fff3cd; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É</h1>
    
    <div>
        <h3>1. HTTP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h3>
        <div id="http-status" class="status loading">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
        <button onclick="testHTTP()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTP</button>
    </div>
    
    <div>
        <h3>2. WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h3>
        <div id="ws-status" class="status loading">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
        <button onclick="testWebSocket()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å WebSocket</button>
    </div>
    
    <div>
        <h3>3. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã</h3>
        <input type="text" id="playerName" placeholder="–í–∞—à–µ –∏–º—è" value="–¢–µ—Å—Ç–æ–≤—ã–π–ò–≥—Ä–æ–∫">
        <button onclick="testCreateRoom()">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
        <div id="room-result" class="status"></div>
    </div>
    
    <script>
        const serverURL = window.location.origin;
        
        function updateStatus(elementId, success, message) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.className = `status ${success === true ? 'success' : success === false ? 'error' : 'loading'}`;
        }
        
        async function testHTTP() {
            try {
                const response = await fetch(`${serverURL}/api/health`);
                const data = await response.json();
                updateStatus('http-status', true, 
                    `‚úÖ HTTP —Ä–∞–±–æ—Ç–∞–µ—Ç! –ö–æ–º–Ω–∞—Ç: ${data.rooms}, uptime: ${Math.round(data.uptime)}s`);
            } catch (error) {
                updateStatus('http-status', false, 
                    `‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        let socket = null;
        
        function testWebSocket() {
            if (socket) socket.disconnect();
            
            updateStatus('ws-status', null, '–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è...');
            
            socket = io(serverURL);
            
            socket.on('connect', () => {
                updateStatus('ws-status', true, '‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω!');
                
                // –¢–µ—Å—Ç–æ–≤—ã–π ping
                socket.emit('ping');
            });
            
            socket.on('pong', (data) => {
                updateStatus('ws-status', true, 
                    `‚úÖ Pong –ø–æ–ª—É—á–µ–Ω! –°–µ—Ä–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è: ${new Date(data.timestamp).toLocaleTimeString()}`);
            });
            
            socket.on('connect_error', (error) => {
                updateStatus('ws-status', false, 
                    `‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
            });
        }
        
        async function testCreateRoom() {
            const playerName = document.getElementById('playerName').value || '–¢–µ—Å—Ç–æ–≤—ã–π–ò–≥—Ä–æ–∫';
            const resultEl = document.getElementById('room-result');
            
            resultEl.textContent = '–°–æ–∑–¥–∞–µ–º –∫–æ–º–Ω–∞—Ç—É...';
            resultEl.className = 'status loading';
            
            if (!socket || !socket.connected) {
                alert('–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å —á–µ—Ä–µ–∑ WebSocket!');
                return;
            }
            
            socket.emit('create-room', { playerName });
            
            socket.once('room-created', (data) => {
                resultEl.innerHTML = `
                    ‚úÖ –ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞!<br>
                    <strong>–ö–æ–¥:</strong> ${data.roomCode}<br>
                    <strong>URL:</strong> <a href="${data.roomUrl}" target="_blank">${data.roomUrl}</a>
                `;
                resultEl.className = 'status success';
                
                console.log('–ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞:', data);
            });
            
            socket.once('room-error', (data) => {
                resultEl.textContent = `‚ùå –û—à–∏–±–∫–∞: ${data.message}`;
                resultEl.className = 'status error';
            });
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
        window.onload = () => {
            testHTTP();
            testWebSocket();
        };
    </script>
</body>
</html>