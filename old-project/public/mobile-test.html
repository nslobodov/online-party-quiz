<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–±–∏–ª—å–Ω—ã–π —Ç–µ—Å—Ç</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f0f0f0; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 10px; }
        button { padding: 15px; width: 100%; margin: 5px 0; background: #007bff; color: white; border: none; border-radius: 5px; }
        .info { background: #e7f3ff; padding: 10px; border-radius: 5px; font-size: 14px; }
    </style>
</head>
<body>
    <h1>üì± –ú–æ–±–∏–ª—å–Ω—ã–π —Ç–µ—Å—Ç</h1>
    
    <div class="card">
        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</h3>
        <div id="device-info" class="info"></div>
    </div>
    
    <div class="card">
        <h3>–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
        <button onclick="testConnection()">üîó –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
        <div id="test-result" class="info"></div>
    </div>
    
    <div class="card">
        <h3>–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ</h3>
        <input type="text" id="roomCode" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã (ABC-123)" style="width: 100%; padding: 10px; margin: 5px 0;">
        <input type="text" id="mobileName" placeholder="–í–∞—à–µ –∏–º—è" value="–ú–æ–±–∏–ª—å–Ω—ã–π–ò–≥—Ä–æ–∫" style="width: 100%; padding: 10px; margin: 5px 0;">
        <button onclick="joinRoom()">üö™ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
        <div id="join-result" class="info"></div>
    </div>
    
    <script>
        const serverURL = window.location.origin;
        let socket = null;
        
        function updateDeviceInfo() {
            const info = document.getElementById('device-info');
            info.innerHTML = `
                üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${navigator.userAgent}<br>
                üñ•Ô∏è –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${navigator.platform}<br>
                üì∂ –û–Ω–ª–∞–π–Ω: ${navigator.onLine ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}<br>
                üîó –°–µ—Ä–≤–µ—Ä: ${serverURL}
            `;
        }
        
        async function testConnection() {
            const resultEl = document.getElementById('test-result');
            resultEl.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º...';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º HTTP
                const response = await fetch(`${serverURL}/api/health`);
                const data = await response.json();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º WebSocket
                if (!socket) {
                    socket = io(serverURL);
                    await new Promise(resolve => {
                        socket.on('connect', resolve);
                        socket.on('connect_error', (err) => {
                            throw new Error(`WebSocket error: ${err.message}`);
                        });
                    });
                }
                
                resultEl.innerHTML = `
                    ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!<br>
                    ‚Ä¢ –°–µ—Ä–≤–µ—Ä –∑–¥–æ—Ä–æ–≤: ${data.healthy ? '‚úÖ' : '‚ùå'}<br>
                    ‚Ä¢ –ö–æ–º–Ω–∞—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö: ${data.rooms}<br>
                    ‚Ä¢ WebSocket: ${socket.connected ? '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω' : '‚ùå –û—Ç–∫–ª—é—á–µ–Ω'}
                `;
            } catch (error) {
                resultEl.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }
        
        function joinRoom() {
            const roomCode = document.getElementById('roomCode').value.trim();
            const playerName = document.getElementById('mobileName').value.trim();
            const resultEl = document.getElementById('join-result');
            
            if (!roomCode || !playerName) {
                resultEl.textContent = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã –∏ –∏–º—è!';
                return;
            }
            
            if (!socket || !socket.connected) {
                resultEl.textContent = '‚ùå –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ!';
                return;
            }
            
            resultEl.textContent = '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è...';
            
            socket.emit('join-room', { roomCode, playerName });
            
            socket.once('room-joined', (data) => {
                resultEl.innerHTML = `
                    ‚úÖ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å!<br>
                    ‚Ä¢ –ò–≥—Ä–æ–∫–æ–≤ –≤ –∫–æ–º–Ω–∞—Ç–µ: ${data.players.length}<br>
                    ‚Ä¢ –í–∞—à–∞ —Ä–æ–ª—å: ${data.isHost ? '–í–µ–¥—É—â–∏–π' : '–ò–≥—Ä–æ–∫'}
                `;
            });
            
            socket.once('room-error', (data) => {
                resultEl.textContent = `‚ùå –û—à–∏–±–∫–∞: ${data.message}`;
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            updateDeviceInfo();
        });
    </script>
    <script src="https://cdn.socket.io/4.8.3/socket.io.min.js"></script>
</body>
</html>